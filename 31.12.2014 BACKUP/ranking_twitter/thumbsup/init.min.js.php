<?php
/**
 * ThumbsUp
 *
 * @author     Geert De Deckere <geert@idoe.be>
 * @link       http://geertdedeckere.be/shop/thumbsup/
 * @copyright  Copyright 2009-2010
 */

// Send the correct HTTP Content-Type header
header('Content-Type: text/javascript; charset=utf-8');

// This file is always called directly, and not included by another PHP page.
// So the include path is relative to this file.
$config = include 'config.php';
?>
(function($){$(function(){var g='<?php echo $config['url'] ?>';var h=$('form.thumbsup');h.submit(function(){return false});h.find(':input').click(function(){var a=$(this);a.closest('form').trigger('thumsup_vote',[a.val()])});h.bind('thumsup_vote',function(c,d){var e=$(this),template=e.attr('name');if(e.hasClass('busy')||e.hasClass('disabled'))return;e.addClass('busy');var f={small:'<img class="spinner" alt="···" src="'+g+'images/spinner_small.gif" />',large:'<img class="spinner" alt="···" src="'+g+'images/spinner_large.gif" />',large_green:'<img class="spinner" alt="···" src="'+g+'images/spinner_large_green.gif" />',large_red:'<img class="spinner" alt="···" src="'+g+'images/spinner_large_red.gif" />',};switch(template){case'buttons':e.find('.question, :button').remove();e.find('.result1').after(' '+f.small);break;case'mini_poll':e.find('.result1, .result2').html(f.small);break;case'mini_thumbs':e.find('.result1').html(f.small);break;case'thumbs_up_down':e.find('.result2').html(f.large_red);case'thumbs_up':e.find('.result1').html(f.large_green);break;case'up_down':e.find('.result1').html(f.large);break}$.ajax({type:'POST',url:g+'init.php',cache:false,dataType:'json',timeout:15000,data:{thumbsup_id:e.find('input[name=thumbsup_id]').val(),thumbsup_format:e.find('input[name=thumbsup_format]').val(),thumbsup_vote:d},error:function(a,b){e.find('.error').text(b)},success:function(a){if('error'in a){switch(a.error){case'invalid_id':e.css('visibility','hidden');alert('The item you voted on no longer exists.');break;case'closed':e.addClass('closed disabled');alert('Voting has been closed for this item.');break;case'already_voted':e.addClass('user_voted disabled');alert('You have already voted on this item.');break;case'login_required':alert('You need to login in order to vote.');break;default:alert(a.error)}return}e.addClass('user_voted disabled');for(var i=0;i<a.item.result.length;i++){e.find('.result'+(i+1)).text(a.item.result[i]).fadeTo(0,0.01).fadeTo('slow',1)}if(template==='mini_poll'){e.find('.graph').css({opacity:0,width:0}).show().filter('.up').animate({opacity:1,width:a.item.votes_pct_up+'%'}).end().filter('.down').animate({opacity:1,width:a.item.votes_pct_down+'%'})}},complete:function(){e.find('.spinner').remove();e.removeClass('busy')}})});$(window).load(function(){if(h.filter('.thumbs_up').length){var a=new Image;a.src=g+'images/spinner_small.gif';var a=new Image;a.src=g+'images/spinner_large.gif';var a=new Image;a.src=g+'images/spinner_large_green.gif';var a=new Image;a.src=g+'images/spinner_large_red.gif'}})})})(jQuery);